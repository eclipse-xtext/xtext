---
layout: post
title:  Xtext 2.8.0 Release Notes
date:   2015-03-11 09:30:28
categories: releasenotes
---

Version 2.8.0 comes with over 260 bugfixes and enhancements, the runtime performance as well as the tool performance has been improved significantly. The full bugzilla log can be found [here](https://bugs.eclipse.org/bugs/buglist.cgi?bug_status=RESOLVED&bug_status=VERIFIED&bug_status=CLOSED&f0=OP&f1=OP&f3=CP&f4=CP&j1=OR&list_id=11172029&query_format=advanced&status_whiteboard=v2.8&status_whiteboard_type=allwordssubstr).

The following features have been added in particular.

## Whitespace-Aware Languages

Xtext 2.8 supports languages in which whitespace is used to specify the structure, e.g. using indentation to delimit code blocks as in [Python](https://www.python.org). This is done through *synthetic tokens* defined in the grammar:

```xtext
terminal BEGIN: 'synthetic:BEGIN';
terminal END: 'synthetic:END';
```

These tokens can be used like other terminals in grammar rules:

```xtext
WhitespaceAwareBlock:
    BEGIN
        ...
    END;
```

The new example language *Home Automation* available in the Eclipse examples (*File &rarr; New &rarr; Example &rarr; Xtext Examples*) demonstrates this concept. It allows code like the following:

```ruleengine
Rule 'Report error' when Heater.error then
    var String report
    do
        Thread.sleep(500)
        report = HeaterDiagnostic.readError
    while (report == null)
    println(report)
```

More details are found in the [documentation]({{site.baseurl}}/documentation/307_special_languages.html#whitespace-aware-languages).

## Enhancements of the Grammar Editor

#### Configurable Severities
You can configure the severity (*ignore / warning / error*) of certain problems that are detected in a grammar file. Open *Xtext &rarr; Errors/Warnings* in the workspace preferences for global settings or in the project properties for project-specific settings.

![]({{site.baseurl}}/images/releasenotes/2_8_xtext-validation-preferences.png)

#### Improved Content Assist
When you hit *Ctrl+Space* after the `with` keyword in a grammar definition, you get a list of available grammars which the currently edited grammar can inherit from.

![]({{site.baseurl}}/images/releasenotes/2_8_xtext-grammar-inheritance.png)

## New Options for Language Code Generation

The *Generator* component supports two new options.

#### Class Annotations

You can specify annotations to be added to each generated Java class. With the following workflow configuration, the annotation `@Generated` is added to each class:

```mwe2
Workflow {
  component = Generator {
      classAnnotation = GeneratedClassAnnotation {}
      ...
  }
}
```

You can also specify your own class annotations by implementing the interface *IClassAnnotation* and adding that implementation to the configuration.

#### File Header

Xtext generates Java files with the following file header comment:

```java
/*
 * generated by Xtext
 */
```

With Xtext 2.8, this can be configured in the workflow configuration with the *fileHeader* property of the *Generator* component.

```mwe2
var myFileHeader = "/*----------------------------
 * My fancy file header
 * (c) \${year} Dr. Evil, inc.
 *----------------------------*/"

Workflow {
  component = Generator {
      fileHeader = myFileHeader
      ...
  }
}
```

## Target Java Version (Xbase)

The new version of the Xbase compiler allows to configure the Java version of the generated code. The default is to use the same version as set for the source compatibility of the Java compiler (*Java &rarr; Compiler &rarr; Source compatibility*), which is in turn usually set to the same version as the *compiler compliance level*. The Xbase compiler settings can be configured in the *Compiler* preference page or project properties page of your Xbase language.

![]({{site.baseurl}}/images/releasenotes/2_8_xbase-java-version.png)

By unchecking *Use source compatibility level from Java settings*, you can choose to generate Java code with a different version than is set for the Java compiler. The actual changes in the generated code are described in the following.

### Java 5

Java 5 has been the default version level of the Xbase compiler from the beginning, so the generated code is the same as with earlier Xbase versions if you choose this target version.

### Java 6

When the Xbase compiler is set to at least Java 6, it generates an `@Override` annotation to each method that overrides a method from a superclass or implements an interface method.

### Java 7

Xbase expressions like `switch (obj) { ... }` where `obj` is of type [String]({{site.javadoc.java}}/java/lang/String.html) are translated to Java `switch` statements (see [Strings in switch Statements](http://docs.oracle.com/javase/8/docs/technotes/guides/language/strings-switch.html)).

In Xbase you can write number literals in the form `2_147_483_647` to enhance their readability. This is also [supported by Java 7](http://docs.oracle.com/javase/8/docs/technotes/guides/language/underscores-literals.html). When the Xbase compiler is set to at least Java 7, underscores in number literals are retained in the generated code.

### Java 8

[Xbase lambda expressions]({{site.baseurl}}/documentation/305_xbase.html#xbase-expressions-lambda) like `[String s | s.toLowerCase]` are translated to [Java 8 lambda expressions](http://docs.oracle.com/javase/tutorial/java/javaOO/lambdaexpressions.html), e.g. `(String s) -> return s.toLowerCase();`. More details on this translation are discussed in [this blog post](http://spoenemann.blogspot.de/2015/02/xtend-for-java-8.html).

Note that independent of which Java version is chosen for the generated code, Xbase works perfectly with the [lambda-optimized Java 8 API](http://docs.oracle.com/javase/8/docs/technotes/guides/language/lambda_api_jdk8.html) because Xbase lambdas are fully compatible with Java 8 lambdas.

## More Compiler Options (Xbase)

You can now disable the automatic generation of `@SuppressWarnings` annotations for generated classes. Furthermore, you can enable the generation of `@Generated` annotations for all generated types, which can be useful for automatic processing of the source code, e.g. when you want to exclude generated types in code analysis tools. The annotation also allows to attach more information, which can be enabled in the preferences.

## Unique Class Name Validation (Xbase)

Unique Java type name checks are now activated for all Xbase languages on a per project level.

## Open Generated File (Xbase)

You can open the Java file that was generated from an Xbase DSL instance by right-clicking the DSL editor and selecting *Open Generated File*.

![]({{site.baseurl}}/images/releasenotes/2_8_xbase-open-generated.png)

## Interruption of Incremental Build

Instead of blocking the user with a modal dialog, running incremental builds will be now get interrupted when a user saves a file. Less blocking, yay!

## New Formatter (Provisional)

Xtext 2.8 comes with a new formatting API in addition to the previous API. The new API allows to implement formatting not only based on the static structure of the grammar but also on the actual model structure. This overcomes many limitations of the previous API, which was present since the first version of Xtext. Things that are now possible include:

*   Add line breaks to long lists of items but keep short lists in one line.
*   Arrange elements in a tabular layout.
*   Apply formatting to values of data type rules or comments.
*   Consider the existing whitespace information and implement an adaptive layout.
*   Provide user configurable preferences for the formatting settings.

More details are found in the [documentation]({{site.baseurl}}/documentation/303_runtime_concepts.html#formatting).

## Storable Resources (Provisional)

Full resolution of Xtext resources can be very expensive. During compilation, complex languages like Xtend go through different phases that involve a lot of computation. With 2.8 we have introduced the possibility to store computed resource state and load it on demand if no changes are expected. We have activated this for Xtend and it reduces the amount of work for incremental changes significantly as dependent resources get loaded from storage much quicker. The API is still provisional for now.

## Xtend Features

#### Convert Java to Xtend
The new version features a Java-to-Xtend converter. Right-click a Java file, package or source folder in the Package Explorer and select *Convert to Xtend*. You can choose to keep the original Java files (though that will lead to errors due to duplicate types), and you are warned if the Java code contains parts that cannot be translated automatically. These are marked with `FIXME` comments in the Xtend code. However, the converter is able to convert the majority of Java classes without problems.

#### More Java 8 Support
The new version of Xtend of course includes all enhancements of Xbase described above, including support for Java 8. In addition, Xtend allows to define non-abstract methods (static or non-static) in interfaces when Java 8 is chosen as target language level. If such a method is non-static, it is translated to a [Java 8 default method](http://docs.oracle.com/javase/tutorial/java/IandI/defaultmethods.html).

## Important Changes

#### Execution Environment
All Xtext plug-ins now require JavaSE-1.6 as execution environment. Furthermore, the Java code generated by Xtext uses `@Override` annotations for methods overriding or implementing other declared methods, so the plug-ins into which this code is generated must use at least JavaSE-1.6 as execution environment. If your plug-ins are set to J2SE-1.5 and you run the Xtext 2.8 code generator, you will probably get compiler errors like *The method 'm' of type 'T' must override a superclass method*; eliminate them by switching to a higher Java version.

#### Regenerate Your Xbase Languages
Xbase languages need to be regenerated once in order to work with version 2.8.

#### Expiring JUnit 3 Support
We are planing to remove support for JUnit version 3. The code form the plug-ins `org.eclipse.xtext.junit` and `org.eclipse.xtext.ui.junit` will be removed from our repository in the next version. Please migrate to the respective counterparts in `org.eclipse.xtext.junit4`.
